---
title: "Project 1"
author: "Dionte Watie"
date: "6/17/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown


```{r}
library(httr)
library(readr)
library(dplyr)
library(jsonlite)
library(tidyverse)
library(DBI)
library(RSQLite)
library(devtools)
library(bigrquery)
library(rvest)
library(knitr)
library(ggplot2)
```

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Franchise, echo=FALSE}
franchise <- function(id){
  franUrl <- paste0("https://records.nhl.com/site/api", "/franchise")
  getFran <- GET(franUrl)
  getFran
  franCont <- content(getFran, as = "text")
  franJson <- fromJSON(franCont, flatten = TRUE)
  franJson
  franList <- as_tibble(franJson$data)
  franList
  }
franchise(19171918)
```


```{r FranchiseTeamTotals, echo=FALSE}
franTeamTot <- function(id){
  TeamUrl <- paste0("https://records.nhl.com/site/api", "/franchise-team-totals")
  getTeam <- GET(TeamUrl)
  getTeam
  TeamCont <- content(getTeam, as = "text")
  TeamJson <- fromJSON(TeamCont, flatten = TRUE)
  TeamJson
  teamList <- as_tibble(TeamJson$data) %>% rename(name = teamName)
  teamList
}



franTeamTot(activeFranchise)
```





```{r SeasonRecords, echo=FALSE}
seasonRecords <- function(id){
  SeasUrl <- paste0("https://records.nhl.com/site/api", "/franchise-season-records?cayenneExp=franchiseId")
  GetSeas <- GET(SeasUrl)
  GetSeas
  SeasCont <- content(GetSeas, as = "text")
  SeasJson <- fromJSON(SeasCont, flatten = TRUE)
  SeasJson
  Seaslist <- as_tibble(SeasJson$data)
  Seaslist
}
seasonRecords(fewestGoalsAgainst)
```




```{r GoalieRecords, echo=FALSE}
goalieRec <- function(id){
  getGoal <- paste0("https://records.nhl.com/site/api", "/franchise-goalie-records")
  goalRec <- GET(getGoal)
  getGoal
  goalCont <- content(getGoal, as = "text")
  goalJson <- fromJSON(goalCont, flatten = TRUE)
  goalJson
  
}
goalieRec()
```



```{r SkaterRecords, echo=FALSE}
skateRec <- function(id){
  skateUrl <- paste0("https://records.nhl.com/site/api", "/franchise-skater-records?cayenneExp=franchiseId")
  getSkate <- GET(skateUrl)
  getSkate
  skateCont <- content(getSkate, as = "text")
  skateJson <- fromJSON(skateCont, flatten = TRUE)
  skateJson
  skateList <- as_tibble(skateJson$data, nrow(10), ncol(30))
  skateList
  }
skateRec(417)
skateList
```


```{r FranchiseDetails, echo=FALSE}
FranDetails <- function(id){
  Fran_url <- paste0("https://records.nhl.com/site/api", "/franchise-detail?cayenneExp=mostRecentTeamId")
  GetDetails <- GET(Fran_url)
  GetDetails
  ContentDetails <- content(GetDetails, as = "text")
  JsonDetails <- fromJSON(ContentDetails, flatten = TRUE)
  JsonDetails
  DetailsList <- as_tibble(JsonDetails$data) 
  DetailsList
  }
FranDetails(captainHistory)
```


```{r}
Modifier <- function(x){
  ModUrl <- paste0("https://statsapi.web.nhl.com/api/v1", "/teams?expand=team.stats")
  GetMod <- GET(ModUrl)
  GetMod
  ModCont <- content(GetMod, as = "text", encoding = "UTF-8")
  ModJson <- fromJSON(ModCont, flatten = TRUE)
  ModJson
  ModList <- as_tibble(ModJson$teams)
  ModList
  }
```



```{r}
nhlEndpoints <- function(franchise, franTeamTot, seasonRecords, skateRec, FranDetails, Modifier){
    if(franchise){ franchise(id)}
  
    if(franTeamTot){franTeamTot(id)}
  
    if(seasonRecords){seasonRecords(id)}
    
    if(skateRec){seasonRecords(id)}
  
    if(FranchisDetails){FranchisDetails(id)}
  
}
nhlEndpoints(5)
```



```{r}
skateList1 <- as_tibble(skateList)
skateAvgs <- summarise(skateList1,avgGamesPlayed = mean(skateList1$gamesPlayed), avgGoals = mean(skateList1$goals), avgAssists = mean(skateList1$assists))
skateAvgs
```



```{r}
TeamList1 <- as_tibble(teamList)
TeamList1
TeamAvgs <- summarise(TeamList1, avgGames = mean(TeamList1$gamesPlayed), avgGoalsFor = mean(TeamList1$goalsFor), avgGoalsAgainst = mean(TeamList1$goalsAgainst))
TeamAvgs
```


```{r}
FranDets <- as_tibble(JsonDetails$data, ncol(10)) %>% select(active, starts_with("team"))
FranDets
ActTeams <- table(FranDets$active, FranDets$teamAbbrev)
ActTeams
kable(ActTeams, caption = "Teams that are still active or not active", ncol(10))
```


```{r}
SeasonNums <- as_tibble(Seaslist) %>% select(franchiseId, franchiseName, mostWins, mostLosses, mostTies)
SeasonNums
kable(SeasonNums, nrow(10), caption = "Seasons with the most Wins, Losses, and Ties")
```


```{r}
Teamtotals <- as_tibble(teamList) %>% select(activeFranchise, name,gamesPlayed, goalsFor, goalsAgainst, homeWins, roadWins, homeLosses, roadLosses) 
Teamtotals
kable(Teamtotals, nrow(10), caption = "Team totals by active and non active teams")
```



```{r}
ActiveTeams <- ggplot(FranDets, aes(active))
ActiveTeams + geom_bar() + labs(x="Active/Inactive Teams", title = "Active teams and inactive teams in the NHL") + scale_x_discrete(labels = c("Inactive", "Active"))
```


```{r}
SkateData<- ggplot(data = skateList1, aes(as.factor(positionCode)))
SkateData + geom_bar(aes(fill = as.factor(mostGoalsOneGame)), position = "dodge") + labs(x = "Position Code", title = "Histogram of the most goals made in one game by position")+ scale_fill_discrete(name = "Goals Made in One Game")
```



```{r}
SeasonPlot <- ggplot(Seaslist, aes(fewestGoalsAgainst))
SeasonPlot + geom_point(aes(fewestGoalsAgainst, fewestLosses), position = "jitter") + labs(x = "Fewest Goals Against", y = " Fewest Losses", title = "Scatter Plot comparing the Fewest Losses and the Fewest Goals Made Against")

```



```{r}
ActivePos <- ggplot(skateList1, aes(as.factor(positionCode)))
ActivePos + geom_boxplot(aes(positionCode, mostPointsOneSeason)) + labs(x = "PositionCode", y = "Most Points in One Seaon")
```

